<!DOCTYPE html>
<html lang="en" class="bg-black text-white">
<head>
  <meta charset="UTF-8" />
  <title>HANGOUT_X [JS-ONLY]</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
  <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet" />
  <style>
    .script-item { transition: all 0.2s; }
    .script-item:hover { background: #1a1a1a; }
  </style>
</head>
<body class="font-mono">

<div class="container mx-auto p-4 max-w-5xl">

  <!-- HEADER -->
  <div class="flex justify-between items-center mb-6 border-b border-gray-800 pb-4">
    <h1 class="text-3xl">HANGOUT_X <span class="text-red-500">LIVE</span></h1>
    <div id="auth-section"></div>
  </div>

  <!-- VIDEO PLAYER -->
  <video id="player" class="video-js vjs-default-skin w-full" controls preload="auto">
    <source src="videos/current.mp4" type="video/mp4" />
    <p class="vjs-no-js">Enable JS, boss.</p>
  </video>

  <!-- OWNER UPLOAD -->
  <div id="owner-upload" class="mt-6 hidden">
    <input type="file" id="video-upload" accept="video/*" class="file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:bg-red-600 file:text-white" />
    <button onclick="uploadVideo()" class="bg-green-600 px-4 py-2 rounded">UPLOAD VIDEO</button>
  </div>

  <!-- SCRIPT VAULT -->
  <div class="mt-8">
    <h2 class="text-xl mb-4 flex justify-between">
      <span>SCRIPT VAULT</span>
      <button onclick="toggleUploadScript()" class="text-cyan-400 text-sm">+ upload script</button>
    </h2>

    <!-- UPLOAD SCRIPT FORM -->
    <div id="script-upload-form" class="hidden mb-4 p-4 bg-gray-900 rounded">
      <input type="text" id="script-name" placeholder="script name" class="w-full mb-2 bg-gray-800 px-3 py-2 rounded" />
      <textarea id="script-code" placeholder="paste code" class="w-full h-32 bg-gray-800 px-3 py-2 rounded font-mono text-sm"></textarea>
      <button onclick="saveScript()" class="mt-2 bg-green-600 px-4 py-2 rounded">SAVE</button>
    </div>

    <!-- SCRIPT LIST -->
    <div id="script-list" class="space-y-2"></div>
  </div>

</div>

<script>
/* ========================================
   HANGOUT_X JS-ONLY CORE (NO BACKEND)
   ======================================== */

// === LOCAL STORAGE DB ===
const DB = {
  get(key) { try { return JSON.parse(localStorage.getItem(key)); } catch { return null; } },
  set(key, val) { localStorage.setItem(key, JSON.stringify(val)); }
};

// === AUTH SYSTEM ===
const OWNER_USER = "admin";
const OWNER_PASS = "boss123"; // Change this in prod
let currentUser = DB.get('currentUser') || null;

function renderAuth() {
  const section = document.getElementById('auth-section');
  if (currentUser) {
    const isOwner = currentUser.username === OWNER_USER;
    section.innerHTML = `
      <div class="flex items-center gap-3">
        <span class="text-green-400">${currentUser.username}</span>
        <input id="aura-input" value="${currentUser.aura}" placeholder="aura" class="bg-gray-800 text-sm px-2 py-1 rounded w-20" 
               onblur="saveAura(this.value)" />
        ${isOwner ? '<span class="text-yellow-500">[OWNER]</span>' : ''}
        <button onclick="logout()" class="text-red-400 text-sm">logout</button>
      </div>
    `;
    if (isOwner) document.getElementById('owner-upload').classList.remove('hidden');
  } else {
    section.innerHTML = `
      <div class="flex gap-2">
        <input id="login-user" placeholder="username" class="bg-gray-800 px-3 py-1 rounded text-sm" />
        <input id="login-pass" type="password" placeholder="pass" class="bg-gray-800 px-3 py-1 rounded text-sm" />
        <button onclick="login()" class="bg-cyan-600 px-3 py-1 rounded text-sm">LOGIN</button>
        <button onclick="register()" class="bg-purple-600 px-3 py-1 rounded text-sm">REGISTER</button>
      </div>
    `;
  }
  loadScripts();
}

function login() {
  const user = document.getElementById('login-user').value.trim();
  const pass = document.getElementById('login-pass').value;
  if (!user || !pass) return alert("Fill it, boss.");

  const users = DB.get('users') || {};
  if (users[user] && users[user].pass === pass) {
    currentUser = { username: user, aura: users[user].aura || 'ðŸ”¥', role: user === OWNER_USER ? 'owner' : 'user' };
    DB.set('currentUser', currentUser);
    renderAuth();
  } else {
    alert("Wrong creds.");
  }
}

function register() {
  const user = prompt("Username:");
  const pass = prompt("Password:");
  if (!user || !pass) return;

  const users = DB.get('users') || {};
  if (users[user]) return alert("Taken.");

  users[user] = { pass, aura: 'ðŸ†•', registered: Date.now() };
  DB.set('users', users);
  alert("Registered. Login now.");
}

function logout() {
  currentUser = null;
  DB.set('currentUser', null);
  renderAuth();
}

function saveAura(aura) {
  if (!currentUser) return;
  currentUser.aura = aura;
  const users = DB.get('users') || {};
  users[currentUser.username].aura = aura;
  DB.set('users', users);
  DB.set('currentUser', currentUser);
}

// === VIDEO UPLOAD (OWNER ONLY) ===
function uploadVideo() {
  const file = document.getElementById('video-upload').files[0];
  if (!file) return alert("Pick a video.");

  const reader = new FileReader();
  reader.onload = function(e) {
    const url = URL.createObjectURL(file);
    document.querySelector('#player source').src = url;
    videojs('player').src(url);
    DB.set('currentVideo', { name: file.name, data: e.target.result });
    alert("Video LIVE.");
  };
  reader.readAsDataURL(file);
}

// Load video on start
window.onload = () => {
  const saved = DB.get('currentVideo');
  if (saved) {
    document.querySelector('#player source').src = saved.data;
    videojs('player').ready(() => videojs('player').src(saved.data));
  }
};

// === SCRIPT VAULT ===
function toggleUploadScript() {
  const form = document.getElementById('script-upload-form');
  form.classList.toggle('hidden');
}

function saveScript() {
  const name = document.getElementById('script-name').value.trim();
  const code = document.getElementById('script-code').value;
  if (!name || !code) return alert("Fill name + code.");

  const scripts = DB.get('scripts') || [];
  scripts.push({ name, code, author: currentUser?.username || 'anon', time: Date.now() });
  DB.set('scripts', scripts);
  document.getElementById('script-name').value = '';
  document.getElementById('script-code').value = '';
  toggleUploadScript();
  loadScripts();
}

function loadScripts() {
  const list = document.getElementById('script-list');
  const scripts = DB.get('scripts') || [];
  list.innerHTML = scripts.map(s => `
    <div class="script-item p-3 bg-gray-900 rounded flex justify-between items-start">
      <div>
        <div class="font-bold text-cyan-400">${s.name}</div>
        <div class="text-xs text-gray-500">${s.author} â€¢ ${new Date(s.time).toLocaleString()}</div>
        <pre class="mt-2 text-xs bg-black p-2 rounded overflow-x-auto">${s.code}</pre>
      </div>
      <div class="flex gap-1">
        <button onclick="copyScript('${btoa(s.code)}')" class="text-green-400 text-xs">COPY</button>
        <button onclick="downloadScript('${s.name}', '${btoa(s.code)}')" class="text-yellow-400 text-xs">DL</button>
        ${currentUser?.username === s.author || currentUser?.role === 'owner' ? `<button onclick="deleteScript(${s.time})" class="text-red-400 text-xs">DEL</button>` : ''}
      </div>
    </div>
  `).join('');
}

function copyScript(b64) {
  navigator.clipboard.writeText(atob(b64));
  alert("Copied to clipboard.");
}

function downloadScript(name, b64) {
  const blob = new Blob([atob(b64)], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = name.endsWith('.js') ? name : name + '.js';
  a.click();
}

function deleteScript(time) {
  if (!confirm("Delete?")) return;
  let scripts = DB.get('scripts') || [];
  scripts = scripts.filter(s => s.time !== time);
  DB.set('scripts', scripts);
  loadScripts();
}

// INIT
renderAuth();
</script>

</body>
</html>
