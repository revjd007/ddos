<!DOCTYPE html>
<html lang="en" class="bg-black text-white overflow-hidden">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>John's Hangout | v13.0 FINAL</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
:root { --red: #ff0033; --dark: #0a0000; --void: #0f0000; }
body { font-family: 'Roboto Mono', monospace; background: #000; color: white; margin: 0; overflow: hidden; }
.orbitron { font-family: 'Orbitron', sans-serif; }
.glow { text-shadow: 0 0 20px var(--red); }
.tab-active { border-bottom: 4px solid var(--red); color: var(--red); }
.message-box { height: calc(100vh - 380px); background: rgba(15,0,0,0.9); border: 2px solid #330011; border-radius: 12px; padding: 20px; overflow-y: auto; margin-bottom: 16px; backdrop-filter: blur(8px); }
.message { margin-bottom: 16px; padding: 12px 16px; border-radius: 12px; max-width: 80%; display: inline-block; }
.message.sent { background: #330011; margin-left: auto; text-align: right; }
.message.received { background: #1a0000; }
.input-box { background: rgba(15,0,0,0.9); border: 2px solid #330011; border-radius: 12px; padding: 16px 20px; font-size: 16px; color: white; outline: none; width: 100%; }
.input-box:focus { border-color: var(--red); box-shadow: 0 0 20px rgba(255,0,51,0.4); }
.send-btn { background: linear-gradient(45deg, #ff0033, #cc0022); color: white; font-weight: bold; padding: 16px 32px; border-radius: 12px; cursor: pointer; border: none; }
.send-btn:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(255,0,51,0.6); }
.voice-bar { background: rgba(20,0,0,0.95); border-top: 1px solid #330011; padding: 12px 20px; display: flex; align-items: center; gap: 16px; font-size: 14px; }
.live-dot { width: 16px; height: 16px; background: radial-gradient(circle, #00ff00, #00cc00); border-radius: 50%; box-shadow: 0 0 20px #00ff00; animation: pulse-live 1.5s infinite; }
@keyframes pulse-live { 0%,100% { opacity: 0.8; } 50% { opacity: 1; } }
.card { background: rgba(15,0,0,0.7); border: 1px solid #330011; border-radius: 12px; padding: 16px; backdrop-filter: blur(8px); }
.btn-red { background: linear-gradient(90deg, #b91c1c, #7f1d1d); color: white; font-weight: bold; padding: 0.5rem 1.5rem; border-radius: 0.5rem; }
.typing { color: #00ff00; font-style: italic; font-size: 0.9em; }
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="fixed top-0 left-0 right-0 bg-black bg-opacity-95 border-b border-red-900 z-50 backdrop-blur-sm">
  <div class="container mx-auto px-6 py-4 flex justify-between items-center">
    <div class="flex items-center gap-3">
      <i class="fas fa-crown text-yellow-500 text-2xl glow"></i>
      <h1 class="text-3xl orbitron glow">John's Hangout</h1>
    </div>
    <div id="auth-section"></div>
  </div>
</nav>

<!-- CONTENT -->
<div class="pt-32 container mx-auto px-6">
  <div id="messages" class="tab-content">
    <h2 class="text-3xl orbitron glow mb-4"><span id="chat-title">PUBLIC</span></h2>
    <div id="message-box" class="message-box"></div>
    <div id="typing-indicator" class="px-6 pb-2 typing hidden">‚óè <span id="typing-user"></span> is typing...</div>
    <div class="p-4 bg-black border-t border-red-900 flex gap-4">
      <input type="text" id="msg-input" placeholder="Type a message..." class="input-box flex-1" onkeydown="handleKeyDown(event)" onkeyup="handleTyping(event)" />
      <button onclick="sendMessage()" class="send-btn orbitron">SEND</button>
    </div>
  </div>
</div>

<script>
const DB = { get: k => { try { return JSON.parse(localStorage.getItem(k)); } catch { return null; } }, set: (k,v) => localStorage.setItem(k, JSON.stringify(v)) };
let currentUser = { username: "Guest", aura: "SOUL" };
let activeChat = "public";
let typingUsers = new Set();
let typingTimeout = null;

// --- Send Message ---
function sendMessage() {
  const input = document.getElementById('msg-input');
  const text = input.value.trim();
  if (!text) return;
  const messages = DB.get('messages') || {};
  if (!messages[activeChat]) messages[activeChat] = [];
  messages[activeChat].push({
    text, user: currentUser.username, aura: currentUser.aura, time: Date.now()
  });
  DB.set('messages', messages);
  input.value = '';
  loadMessages();
}

// --- Load Messages ---
function loadMessages() {
  const box = document.getElementById('message-box');
  const messages = (DB.get('messages') || {})[activeChat] || [];
  box.innerHTML = messages.map(m => `
    <div class="message ${m.user === currentUser.username ? 'sent' : 'received'}">
      <div class="text-red-400 font-bold text-sm">${m.aura}</div>
      <div class="text-white">${m.text}</div>
      <div class="text-xs text-gray-400">${new Date(m.time).toLocaleTimeString()}</div>
    </div>
  `).join('');
  box.scrollTop = box.scrollHeight;
}

// --- Handle Enter Key ---
function handleKeyDown(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    sendMessage();
  }
}

// --- Typing Indicator ---
function handleTyping(e) {
  if (e.target.value.trim().length > 0) {
    typingUsers.add(currentUser.username);
    showTyping();
    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(clearTyping, 1500);
  } else {
    clearTyping();
  }
}
function showTyping() {
  document.getElementById('typing-user').textContent = Array.from(typingUsers).join(', ');
  document.getElementById('typing-indicator').classList.remove('hidden');
}
function clearTyping() {
  typingUsers.clear();
  document.getElementById('typing-indicator').classList.add('hidden');
}

// --- Init ---
loadMessages();
</script>
</body>
</html>
