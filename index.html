<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SocialHub</title>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-dark.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root { --bg: #000; --text: #fff; --accent: #ff0000; --glass: rgba(255,0,0,0.15); --border: rgba(255,0,0,0.3); }
    .dark { --bg: #0a0a0a; --glass: rgba(255,0,0,0.1); }
    body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; transition: 0.4s; }
    .glass { backdrop-filter: blur(20px); background: var(--glass); border: 1px solid var(--border); }
    .card { transition: all 0.4s; }
    .card:hover { transform: translateY(-12px); box-shadow: 0 40px 80px rgba(255,0,0,0.5); }
    .bento { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem; }
    video, iframe { width: 100%; height: 300px; border-radius: 12px; }
    .online { width: 12px; height: 12px; background: #0f0; border-radius: 50%; }
    .typing { font-style: italic; color: #ff5555; }
    .notification { position: fixed; top: 20px; right: 20px; background: #ff0000; color: white; padding: 12px 20px; border-radius: 12px; z-index: 1000; animation: slide 0.3s; }
    @keyframes slide { from { transform: translateX(100%); } to { transform: translateX(0); } }
  </style>
</head>
<body class="min-h-screen">
  <!-- NAVBAR -->
  <nav class="glass fixed top-0 w-full z-50 p-4">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <h1 class="text-3xl font-black bg-gradient-to-r from-red-500 to-red-600 bg-clip-text text-transparent">SocialHub</h1>
      <div class="flex gap-3">
        <button onclick="show('home')" class="px-5 py-2 rounded glass">Home</button>
        <button onclick="show('hub')" class="px-5 py-2 rounded glass">Hub</button>
        <button onclick="show('chat')" class="px-5 py-2 rounded glass">Chat</button>
        <button onclick="show('profile')" id="profileBtn" class="hidden px-5 py-2 rounded bg-gradient-to-r from-red-500 to-red-600 text-white">Me</button>
        <button onclick="toggleDark()" class="p-2 rounded glass">Toggle</button>
      </div>
    </div>
  </nav>

  <!-- HOME -->
  <div id="home" class="pt-32 text-center">
    <h1 class="text-7xl font-black mb-6 bg-gradient-to-r from-red-500 to-red-600 bg-clip-text text-transparent">Social Gaming Hub</h1>
    <div class="max-w-md mx-auto">
      <input id="username" placeholder="Choose username" class="p-4 rounded-2xl w-full mb-4 glass" />
      <button onclick="login()" class="w-full py-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-2xl font-bold">Join</button>
    </div>
  </div>

  <!-- HUB -->
  <div id="hub" class="hidden pt-32 max-w-7xl mx-auto px-6">
    <div class="flex justify-between mb-6">
      <h2 class="text-5xl font-black bg-gradient-to-r from-red-500 to-red-600 bg-clip-text text-transparent">Content Hub</h2>
      <button onclick="showUpload()" class="px-6 py-3 bg-red-600 text-white rounded-xl">+</button>
    </div>
    <div id="contentGrid" class="bento"></div>
  </div>

  <!-- CHAT -->
  <div id="chat" class="hidden pt-32 max-w-7xl mx-auto px-6 flex gap-6">
    <div class="flex-1">
      <h2 class="text-4xl font-black mb-4">Global Chat</h2>
      <div id="globalChat" class="h-96 overflow-y-auto glass p-4 mb-4"></div>
      <div class="flex gap-2">
        <input id="globalMsg" placeholder="Type..." class="flex-1 p-3 rounded glass" onkeydown="if(event.key==='Enter') sendGlobal()" />
        <button onclick="sendGlobal()" class="px-6 py-3 bg-red-600 text-white rounded">Send</button>
      </div>
    </div>
    <div class="w-80">
      <h3 class="text-2xl font-bold mb-4">Online Users</h3>
      <input id="searchInput" placeholder="Find player..." class="w-full p-3 rounded glass mb-3" onkeyup="filterUsers()" />
      <div id="onlineUsers" class="space-y-2"></div>
    </div>
  </div>

  <!-- PROFILE -->
  <div id="profile" class="hidden pt-32 max-w-4xl mx-auto px-6">
    <div class="glass p-8 rounded-3xl">
      <div class="flex items-center gap-6 mb-6">
        <img id="avatar" src="https://via.placeholder.com/120" class="w-32 h-32 rounded-full" />
        <div>
          <h2 id="profileName" class="text-4xl font-black"></h2>
          <p id="profileBio" class="text-lg opacity-80"></p>
        </div>
      </div>
      <button onclick="showSettings()" class="px-6 py-3 bg-red-600 text-white rounded-xl">Edit Profile</button>
      <div class="grid grid-cols-3 gap-4 mt-8">
        <div class="text-center"><p class="text-3xl font-bold" id="pLikes">0</p><p>Likes</p></div>
        <div class="text-center"><p class="text-3xl font-bold" id="pContent">0</p><p>Content</p></div>
        <div class="text-center"><p class="text-3xl font-bold" id="pMessages">0</p><p>Messages</p></div>
      </div>
    </div>
  </div>

  <!-- UPLOAD MODAL -->
  <div id="uploadModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
    <div class="glass p-10 rounded-3xl w-full max-w-2xl">
      <select id="uploadType" class="p-4 rounded-2xl w-full mb-4 glass">
        <option value="video">Video</option>
        <option value="game">Game (HTML)</option>
        <option value="script">Script</option>
      </select>
      <input id="uploadTitle" placeholder="Title" class="p-4 rounded-2xl w-full mb-4 glass" />
      <input type="file" id="uploadFile" class="p-4 rounded-2xl w-full mb-4 glass" />
      <button onclick="upload()" class="w-full py-4 bg-red-600 text-white rounded-2xl">Upload</button>
      <button onclick="hideUpload()" class="w-full py-2 mt-2 text-white">Cancel</button>
    </div>
  </div>

  <!-- SETTINGS MODAL -->
  <div id="settingsModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
    <div class="glass p-8 rounded-3xl w-full max-w-md">
      <input id="setName" placeholder="Name" class="p-3 rounded w-full mb-3 glass" />
      <textarea id="setBio" placeholder="Bio" class="p-3 rounded w-full mb-3 glass h-24"></textarea>
      <input type="file" id="setAvatar" class="mb-3" />
      <button onclick="saveProfile()" class="w-full py-3 bg-red-600 text-white rounded">Save</button>
      <button onclick="hideSettings()" class="w-full py-2 mt-2 text-white">Cancel</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script>
    let me = { name: '', bio: '', avatar: '', likes: 0, content: 0, messages: 0 };
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    let content = JSON.parse(localStorage.getItem('content') || '[]');
    let messages = JSON.parse(localStorage.getItem('messages') || '[]');
    let online = new Set();

    function login() {
      const name = document.getElementById('username').value.trim() || 'Player' + Date.now().toString(36);
      me.name = name;
      if (!users[name]) users[name] = { bio: '', avatar: 'https://via.placeholder.com/120', likes: 0, content: 0, messages: 0 };
      me = { ...me, ...users[name] };
      localStorage.setItem('me', name);
      document.getElementById('profileBtn').classList.remove('hidden');
      show('hub');
      init();
    }

    function init() {
      online.add(me.name);
      setInterval(() => {
        online = new Set(Object.keys(users).filter(u => Date.now() - (users[u].lastSeen || 0) < 30000));
        renderOnline();
      }, 5000);
      renderContent();
      renderOnline();
      loadProfile();
    }

    function show(page) {
      ['home','hub','chat','profile'].forEach(id => document.getElementById(id).classList.add('hidden'));
      document.getElementById(page).classList.remove('hidden');
      if (page === 'chat') renderGlobalChat();
      if (page === 'hub') renderContent();
    }

    function showUpload() {
      document.getElementById('uploadModal').classList.remove('hidden');
    }
    function hideUpload() {
      document.getElementById('uploadModal').classList.add('hidden');
    }
    function showSettings() {
      document.getElementById('setName').value = me.name;
      document.getElementById('setBio').value = me.bio;
      document.getElementById('settingsModal').classList.remove('hidden');
    }
    function hideSettings() {
      document.getElementById('settingsModal').classList.add('hidden');
    }

    function upload() {
      const type = document.getElementById('uploadType').value;
      const title = document.getElementById('uploadTitle').value;
      const file = document.getElementById('uploadFile').files[0];
      if (!title || !file) return notify('Fill title and file');
      const reader = new FileReader();
      reader.onload = (e) => {
        const item = { id: Date.now(), type, title, content: type === 'video' ? URL.createObjectURL(file) : e.target.result, user: me.name, likes: 0, comments: [] };
        content.push(item);
        me.content++;
        users[me.name].content++;
        localStorage.setItem('content', JSON.stringify(content));
        localStorage.setItem('users', JSON.stringify(users));
        hideUpload();
        renderContent();
        notify('Uploaded!');
      };
      reader.readAsText(file);
    }

    function renderContent() {
      const grid = document.getElementById('contentGrid');
      grid.innerHTML = '';
      content.forEach(item => {
        const card = document.createElement('div');
        card.className = 'glass p-6 rounded-3xl card';
        card.innerHTML = `
          <h3 class="text-2xl font-bold mb-2">${item.title}</h3>
          <p class="text-sm opacity-70 mb-4">by <a href="#" onclick="viewProfile('${item.user}'); return false;" class="text-red-400 underline">${item.user}</a></p>
          ${item.type === 'video' ? `<video controls src="${item.content}" class="mb-4"></video>` : ''}
          ${item.type === 'game' ? `<iframe srcdoc="${item.content}" class="mb-4"></iframe>` : ''}
          ${item.type === 'script' ? `<pre><code class="language-js">${Prism.highlight(item.content, Prism.languages.js, 'js')}</code></pre>` : ''}
          <div class="flex justify-between mt-4">
            <button onclick="like(${item.id})" class="text-red-400">Heart ${item.likes}</button>
            <button onclick="comment(${item.id})" class="text-red-400">Comment</button>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function like(id) {
      const item = content.find(c => c.id === id);
      if (item) { item.likes++; me.likes++; users[me.name].likes++; localStorage.setItem('users', JSON.stringify(users)); renderContent(); }
    }

    function comment(id) {
      const text = prompt('Comment:');
      if (text) {
        const item = content.find(c => c.id === id);
        item.comments = item.comments || [];
        item.comments.push({ user: me.name, text });
        localStorage.setItem('content', JSON.stringify(content));
        renderContent();
      }
    }

    function sendGlobal() {
      const msg = document.getElementById('globalMsg').value.trim();
      if (msg) {
        messages.push({ type: 'global', user: me.name, msg, time: new Date().toLocaleTimeString() });
        me.messages++;
        users[me.name].messages++;
        localStorage.setItem('messages', JSON.stringify(messages));
        localStorage.setItem('users', JSON.stringify(users));
        document.getElementById('globalMsg').value = '';
        renderGlobalChat();
      }
    }

    function renderGlobalChat() {
      const chat = document.getElementById('globalChat');
      chat.innerHTML = messages.filter(m => m.type === 'global').map(m => `<div class="mb-2"><strong>${m.user}</strong>: ${m.msg} <span class="text-xs opacity-50">${m.time}</span></div>`).join('');
      chat.scrollTop = chat.scrollHeight;
    }

    function filterUsers() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      renderOnline(query);
    }

    function renderOnline(filter = '') {
      const list = document.getElementById('onlineUsers');
      list.innerHTML = '';
      const filtered = Object.keys(users).filter(u => u.toLowerCase().includes(filter));
      filtered.forEach(u => {
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between glass p-3 rounded mb-2';
        div.innerHTML = `<span><span class="online inline-block mr-2"></span>${u}</span><button onclick="dm('${u}')" class="text-xs text-red-400">DM</button>`;
        list.appendChild(div);
      });
    }

    function dm(user) {
      const msg = prompt(`Message to ${user}:`);
      if (msg) {
        messages.push({ type: 'dm', from: me.name, to: user, msg });
        localStorage.setItem('messages', JSON.stringify(messages));
        notify(`DM sent to ${user}`);
      }
    }

    function viewProfile(user) {
      const u = users[user];
      if (u) {
        document.getElementById('profileName').innerText = user;
        document.getElementById('profileBio').innerText = u.bio;
        document.getElementById('avatar').src = u.avatar;
        document.getElementById('pLikes').innerText = u.likes;
        document.getElementById('pContent').innerText = u.content;
        document.getElementById('pMessages').innerText = u.messages;
        show('profile');
      }
    }

    function saveProfile() {
      me.name = document.getElementById('setName').value || me.name;
      me.bio = document.getElementById('setBio').value;
      const file = document.getElementById('setAvatar').files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => { me.avatar = e.target.result; finalizeSave(); };
        reader.readAsDataURL(file);
      } else finalizeSave();
    }

    function finalizeSave() {
      users[me.name] = { ...me, lastSeen: Date.now() };
      localStorage.setItem('users', JSON.stringify(users));
      hideSettings();
      loadProfile();
      notify('Profile saved!');
    }

    function loadProfile() {
      document.getElementById('profileName').innerText = me.name;
      document.getElementById('profileBio').innerText = me.bio;
      document.getElementById('avatar').src = me.avatar;
      document.getElementById('pLikes').innerText = me.likes;
      document.getElementById('pContent').innerText = me.content;
      document.getElementById('pMessages').innerText = me.messages;
    }

    function notify(msg) {
      const n = document.createElement('div');
      n.className = 'notification';
      n.innerText = msg;
      document.body.appendChild(n);
      setTimeout(() => n.remove(), 3000);
    }

    function toggleDark() {
      document.body.classList.toggle('dark');
    }

    // AUTO LOGIN
    const saved = localStorage.getItem('me');
    if (saved && users[saved]) {
      me.name = saved;
      me = { ...me, ...users[saved] };
      document.getElementById('profileBtn').classList.remove('hidden');
      show('hub');
      init();
    }
  </script>
</body>
</html>
