<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SocialHub</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root { --bg: #000; --text: #fff; --accent: #ff0000; --glass: rgba(255,0,0,0.18); --border: rgba(255,0,0,0.35); }
    .dark { --bg: #0a0a0a; --glass: rgba(255,0,0,0.12); }
    body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; }
    .glass { backdrop-filter: blur(24px); background: var(--glass); border: 1px solid var(--border); border-radius: 1.5rem; }
    .card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .card:hover { transform: translateY(-16px) scale(1.02); box-shadow: 0 50px 100px rgba(255,0,0,0.6); }
    .feed { height: 100vh; overflow-y: scroll; scroll-snap-type: y mandatory; }
    .video-item { scroll-snap-align: start; height: 100vh; position: relative; }
    video { width: 100%; height: 100%; object-fit: contain; background: #111; }
    .msg { display: flex; gap: 12px; margin: 12px 0; align-items: flex-start; }
    .msg img { width: 40px; height: 40px; border-radius: 50%; }
    .msg-bubble { background: rgba(255,0,0,0.2); padding: 10px 16px; border-radius: 18px; max-width: 70%; }
    .dot-menu { width: 8px; height: 8px; background: #fff; border-radius: 50%; cursor: pointer; }
    .ban-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #ff3333; font-size: 2rem; }
    .floating { position: fixed; bottom: 24px; right: 24px; width: 64px; height: 64px; background: linear-gradient(135deg, #ff0000, #cc0000); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; box-shadow: 0 10px 30px rgba(255,0,0,0.5); cursor: pointer; transition: 0.3s; }
    .floating:hover { transform: scale(1.1); }
    .notification { position: fixed; top: 20px; right: 20px; background: #ff0000; color: white; padding: 16px 24px; border-radius: 16px; z-index: 1000; animation: pop 0.4s; font-weight: 600; }
    @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
  </style>
</head>
<body class="min-h-screen">

  <!-- BANNED SCREEN -->
  <div id="bannedScreen" class="ban-screen hidden">
    <h1 class="text-6xl font-black mb-4">BANNED</h1>
    <p id="banReason" class="text-2xl"></p>
  </div>

  <!-- AUTH (same as before) -->
  <!-- ... (keep your auth HTML) ... -->

  <!-- APP -->
  <div id="app" class="hidden">
    <!-- NAVBAR (advanced with search) -->
    <nav class="glass fixed top-0 w-full z-40 p-4 backdrop-blur-xl">
      <div class="max-w-7xl mx-auto flex justify-between items-center">
        <h1 class="text-3xl font-black bg-gradient-to-r from-red-500 to-red-600 bg-clip-text text-transparent">SocialHub</h1>
        <div class="flex gap-3">
          <input id="searchUsers" placeholder="Find Player..." class="p-3 rounded-xl glass" onkeyup="searchUsers()" />
          <button onclick="show('feed')" class="px-6 py-2 rounded-xl glass font-semibold">Feed</button>
          <button onclick="show('chat')" class="px-6 py-2 rounded-xl glass font-semibold">Chat</button>
          <button onclick="show('profile')" class="px-6 py-2 rounded-xl bg-gradient-to-r from-red-500 to-red-600 text-white font-bold">Me</button>
        </div>
      </div>
    </nav>

    <!-- FEED (TikTok style) -->
    <div id="feed" class="feed pt-20 hidden">
      <div id="videoGrid"></div>
    </div>

    <!-- CHAT (Discord style) -->
    <div id="chat" class="hidden pt-32 max-w-7xl mx-auto px-6 flex gap-6">
      <div class="w-80">
        <div id="userList" class="space-y-2"></div>
      </div>
      <div class="flex-1">
        <div id="chatHeader" class="glass p-4 rounded-t-2xl mb-1 flex justify-between items-center">
          <h2 id="chatTitle" class="text-2xl font-black">Global</h2>
        </div>
        <div id="chatMessages" class="h-96 overflow-y-auto glass p-6 mb-2" style="max-height: 70vh;"></div>
        <input id="msgInput" placeholder="Message..." class="w-full p-4 rounded-2xl glass" onkeydown="handleEnter(event)" />
      </div>
    </div>

    <!-- Other sections (hub, profile, modals) same as before, but add backend calls in JS -->
  </div>

  <script>
    let token = '';
    let me = {};
    let currentDM = null;

    // AUTH CALLS
    async function register() {
      const res = await fetch('/api/register', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({email: regEmail.value, password: regPass.value, name: regName.value}) });
      if (res.ok) { /* show code input */ }
    }

    async function login() {
      const res = await fetch('/api/login', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({email: loginEmail.value, password: loginPass.value}) });
      const data = await res.json();
      if (data.token) {
        token = data.token;
        me = data.user;
        localStorage.setItem('token', token);
        showApp();
        init();
      }
    }

    async function searchUsers() {
      const query = searchUsers.value;
      const res = await fetch('/api/users?query=' + query, { headers: { Authorization: `Bearer ${token}` } });
      const results = await res.json();
      // Render list with dot menu for admin
      userList.innerHTML = results.map(u => `
        <div class="glass p-4 rounded-2xl flex justify-between cursor-pointer" onclick="openDM('${u.id}')">
          <div class="flex items-center gap-3">
            <img src="${u.avatar}" class="w-10 h-10 rounded-full" />
            <span>${u.name}</span>
          </div>
          ${me.isAdmin ? `<div class="relative"><span class="dot-menu" onclick="event.stopPropagation(); adminMenu('${u.id}')"></span></div>` : ''}
        </div>
      `).join('');
    }

    function adminMenu(id) {
      const action = prompt('1. Ban\n2. Kick');
      if (action === '1') {
        const reason = prompt('Reason:');
        fetch('/api/users', { method: 'POST', headers: {'Content-Type': 'application/json', Authorization: `Bearer ${token}`}, body: JSON.stringify({targetId: id, reason}) });
      }
    }

    async function sendMessage() {
      const input = msgInput;
      const msg = input.value.trim();
      if (!msg) return;
      await fetch('/api/messages', { method: 'POST', headers: {'Content-Type': 'application/json', Authorization: `Bearer ${token}`}, body: JSON.stringify({toId: currentDM, content: msg}) });
      input.value = '';
      loadMessages();
    }

    async function loadMessages() {
      const res = await fetch(`/api/messages?toId=${currentDM || ''}`, { headers: { Authorization: `Bearer ${token}` } });
      const msgs = await res.json();
      chatMessages.innerHTML = msgs.map(m => `
        <div class="msg">
          <img src="${m.from.avatar}" />
          <div>
            <div class="flex items-center gap-2">
              <strong>${m.from.name}</strong>
              <span class="text-xs opacity-50">${m.createdAt}</span>
            </div>
            <div class="msg-bubble">${m.content}</div>
          </div>
        </div>
      `).join('');
    }

    // Other functions (upload, renderFeed, etc.) call /api/videos, /api/users
    async function renderFeed() {
      const res = await fetch('/api/videos', { headers: { Authorization: `Bearer ${token}` } });
      const videos = await res.json();
      videoGrid.innerHTML = videos.map(v => `
        <div class="video-item">
          <video src="${v.url}" loop autoplay muted></video>
          <div class="absolute bottom-6 left-6">
            <p class="text-2xl font-bold">${v.title}</p>
            <p>by ${v.user.name}</p>
          </div>
        </div>
      `).join('');
    }

    // INIT
    if (localStorage.getItem('token')) {
      // Fetch me from /api/me
      // ...
    }
  </script>
</body>
</html>
