<!DOCTYPE html>
<html>
<head>
  <title>ScriptShare</title>
  <style>
    body { font-family: Arial; margin: 40px; background: #f4f4f4; }
    .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; }
    input, button, textarea { width: 100%; padding: 10px; margin: 10px 0; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    .script { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ScriptShare</h1>
    <div id="loginForm">
      <input id="email" placeholder="Email" type="email" />
      <input id="pass" placeholder="Password" type="password" />
      <button onclick="login()">Login / Register</button>
    </div>

    <div id="uploadForm" class="hidden">
      <h3>Upload Script</h3>
      <input id="title" placeholder="Script Title" />
      <input type="file" id="file" accept=".js,.py,.txt" />
      <button onclick="upload()">Post Script</button>
      <button onclick="logout()">Logout</button>
    </div>

    <div id="feed"></div>
  </div>

  <script>
    const API = '/api';
    let token = localStorage.getItem('token');

    async function login() {
      const email = document.getElementById('email').value;
      const pass = document.getElementById('pass').value;
      const res = await fetch(API + '/auth', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, pass })
      });
      const data = await res.json();
      if (data.token) {
        token = data.token;
        localStorage.setItem('token', token);
        showUpload();
        loadFeed();
      }
    }

    function showUpload() {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('uploadForm').classList.remove('hidden');
    }

    function logout() {
      localStorage.removeItem('token');
      token = null;
      location.reload();
    }

    async function upload() {
      const title = document.getElementById('title').value;
      const file = document.getElementById('file').files[0];
      const reader = new FileReader();
      reader.onload = async () => {
        await fetch(API + '/script', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, content: reader.result, filename: file.name })
        });
        document.getElementById('title').value = '';
        document.getElementById('file').value = '';
        loadFeed();
      };
      reader.readAsText(file);
    }

    async function loadFeed() {
      const res = await fetch(API + '/scripts');
      const scripts = await res.json();
      const feed = document.getElementById('feed');
      feed.innerHTML = '<h3>All Scripts</h3>';
      scripts.forEach(s => {
        const div = document.createElement('div');
        div.className = 'script';
        div.innerHTML = `<strong>${s.title}</strong> by ${s.user}<br><code>${s.filename}</code><pre>${s.content}</pre>`;
        feed.appendChild(div);
      });
    }

    if (token) { showUpload(); loadFeed(); }
  </script>
</body>
</html>
